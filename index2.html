<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Seoul Trip Planner with AI Features</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral (Slate, Stone, Amber) -->
    <!-- Application Structure Plan: A tabbed, single-page dashboard design was chosen over a linear report structure to provide non-linear, task-oriented access to information. Users can instantly jump to the daily itinerary, food guide, or logistics without extensive scrolling. The core interaction is an expandable card for each day's schedule, making the detailed plan easily accessible. This structure is optimized for on-the-go use by a traveler who needs quick answers. Gemini API features are integrated directly into relevant sections (Itinerary tweaks) and as a new, dedicated 'Culture' tab for Q&A. -->
    <!-- Visualization & Content Choices: Report Info: Airport Transport Table -> Goal: Compare options -> Viz: Interactive Bar Chart (Chart.js) -> Interaction: Hover tooltips -> Justification: Visually more intuitive and engaging for comparing quantitative data (cost/time) than a static table. Report Info: Daily Itinerary Text -> Goal: Organize daily plan -> Viz: Expandable HTML/CSS Cards -> Interaction: Click to expand/collapse -> Justification: Hides complexity, allows users to focus on one day at a time, better for mobile viewing. Report Info: Gemini API Integration -> Goal: Provide dynamic, personalized travel advice -> Viz: Modal pop-ups and dedicated Q&A section -> Interaction: Button clicks and text input -> Justification: Integrates AI assistance seamlessly without cluttering the main UI, providing on-demand intelligence. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-active { 
            border-color: #f59e0b; 
            color: #f59e0b;
            background-color: #fffbeb;
        }
        .section { display: none; }
        .section.active { display: block; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 400px; }
        }
        .day-card-header { transition: background-color 0.3s ease; }
        .day-card-header:hover { background-color: #f7fafc; }
        .details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s ease-in-out;
        }
        .details-content.open {
            max-height: 2000px;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f59e0b;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-stone-50 text-slate-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <h1 class="text-2xl font-bold text-slate-800 mb-2 sm:mb-0">Seoul Expedition Planner</h1>
                <nav id="main-nav" class="flex flex-wrap justify-center gap-2 sm:gap-4">
                    <button data-tab="overview" class="nav-tab px-4 py-2 text-sm font-medium text-slate-600 border-b-2 border-transparent hover:text-amber-600 hover:border-amber-600 transition">Overview</button>
                    <button data-tab="itinerary" class="nav-tab px-4 py-2 text-sm font-medium text-slate-600 border-b-2 border-transparent hover:text-amber-600 hover:border-amber-600 transition">Itinerary</button>
                    <button data-tab="logistics" class="nav-tab px-4 py-2 text-sm font-medium text-slate-600 border-b-2 border-transparent hover:text-amber-600 hover:border-amber-600 transition">Logistics</button>
                    <button data-tab="food" class="nav-tab px-4 py-2 text-sm font-medium text-slate-600 border-b-2 border-transparent hover:text-amber-600 hover:border-amber-600 transition">Food Guide</button>
                    <button data-tab="culture" class="nav-tab px-4 py-2 text-sm font-medium text-slate-600 border-b-2 border-transparent hover:text-amber-600 hover:border-amber-600 transition">Culture</button>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 md:p-8">
        
        <section id="overview" class="section">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                <h2 class="text-3xl font-bold text-amber-600 mb-4">Your AI-Powered Adventure in Seoul!</h2>
                <p class="text-slate-600 max-w-3xl mx-auto mb-6">
                    Welcome to your personalized, interactive guide for an unforgettable week in Seoul. This dashboard is now enhanced with AI to help you plan and explore. Use the tabs to find your itinerary, logistics, and food guide. Check the new **Culture** tab to ask questions, and look for the ‚ú® sparkle buttons in the itinerary for AI-powered suggestions!
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                    <div class="bg-stone-100 p-6 rounded-lg">
                        <h3 class="font-bold text-lg mb-2 text-slate-700">Trip Details</h3>
                        <p><strong>Destination:</strong> Seoul, South Korea</p>
                        <p><strong>Duration:</strong> 7 Days / 6 Nights</p>
                        <p><strong>Dates:</strong> Oct 5th - Oct 11th</p>
                        <p><strong>Travelers:</strong> 3 (2 Adults, 1 Child)</p>
                    </div>
                    <div class="bg-stone-100 p-6 rounded-lg">
                        <h3 class="font-bold text-lg mb-2 text-slate-700">Recommended Basecamp</h3>
                        <p><strong>Neighborhood:</strong> Myeongdong</p>
                        <p><strong>Why:</strong> A vibrant, central hub with endless shopping, dining, and street food, making it an exciting and convenient base for explorers of all ages.</p>
                    </div>
                    <div class="bg-stone-100 p-6 rounded-lg">
                        <h3 class="font-bold text-lg mb-2 text-slate-700">How to Use This Guide</h3>
                        <p>Click the tabs to switch sections. In the 'Itinerary' tab, click on any day to expand its schedule and find AI-powered tweaks. The new 'Culture' tab lets you ask questions about Korea.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="itinerary" class="section">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-2 text-amber-600">Daily Expedition Plan</h2>
                <p class="text-slate-600 text-center max-w-3xl mx-auto mb-8">
                    This is your day-by-day guide. Click a day to reveal the plan and look for the ‚ú® button to get AI-powered suggestions to make the day even more fun for your 12-year-old!
                </p>
                <div id="itinerary-container" class="space-y-4"></div>
            </div>
        </section>

        <section id="logistics" class="section">
             <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-2 text-amber-600">Arrival & Logistics Blueprint</h2>
                <p class="text-slate-600 text-center max-w-3xl mx-auto mb-8">
                    A smooth journey starts with solid planning. This section covers the essential logistics for your arrival and for navigating Seoul like a pro.
                </p>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-slate-700">Incheon Airport to Myeongdong</h3>
                        <p class="text-slate-600 mb-6">For a family arriving with luggage after a long flight, the <strong class="text-amber-700">Airport Limousine Bus</strong> is the top recommendation. The chart below compares options.</p>
                        <div class="chart-container bg-stone-50 p-4 rounded-lg">
                            <canvas id="transport-chart"></canvas>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8 pt-8">
                        <div class="bg-stone-100 p-6 rounded-lg">
                           <h3 class="text-2xl font-semibold mb-3 text-slate-700">Connectivity: eSIM</h3>
                           <p class="text-slate-600">For seamless navigation, an <strong class="text-amber-700">eSIM</strong> for each adult is highly recommended. It eliminates extra hardware and ensures individual connectivity.</p>
                        </div>
                        <div class="bg-stone-100 p-6 rounded-lg">
                           <h3 class="text-2xl font-semibold mb-3 text-slate-700">Transit & Payment: WOWPASS</h3>
                           <p class="text-slate-600">The <strong class="text-amber-700">WOWPASS</strong> is an all-in-one card for tourists, combining currency exchange, a prepaid debit card, and a transit card. Get one at the airport.</p>
                        </div>
                    </div>
                     <div>
                        <h3 class="text-2xl font-semibold mb-4 mt-8 text-slate-700">Hotel Recommendations in Myeongdong</h3>
                        <div id="hotel-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="food" class="section">
             <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-2 text-amber-600">A Culinary Field Guide</h2>
                 <p class="text-slate-600 text-center max-w-3xl mx-auto mb-6">
                    Seoul is a food lover's paradise. This guide introduces you to essential Korean dishes. Use the filters to sort dishes by spice level to find the perfect meal.
                </p>
                <div id="food-filters" class="flex justify-center gap-2 mb-8 flex-wrap">
                    <button data-filter="all" class="food-filter-btn px-4 py-2 text-sm font-medium rounded-full transition bg-amber-500 text-white">All</button>
                    <button data-filter="1" class="food-filter-btn px-4 py-2 text-sm font-medium rounded-full transition bg-stone-200 text-slate-700 hover:bg-stone-300">Mild (üå∂Ô∏è)</button>
                    <button data-filter="2-3" class="food-filter-btn px-4 py-2 text-sm font-medium rounded-full transition bg-stone-200 text-slate-700 hover:bg-stone-300">Medium (üå∂Ô∏èüå∂Ô∏è)</button>
                    <button data-filter="4" class="food-filter-btn px-4 py-2 text-sm font-medium rounded-full transition bg-stone-200 text-slate-700 hover:bg-stone-300">Spicy (üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è)</button>
                </div>
                <div id="food-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>
        </section>

        <section id="culture" class="section">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-2 text-amber-600">‚ú® AI Culture Guide</h2>
                <p class="text-slate-600 text-center max-w-3xl mx-auto mb-8">
                    Have a question about Korean culture, etiquette, or language? Ask your AI guide! Whether you're wondering about tipping customs or how to say "hello," get instant, helpful answers for your trip.
                </p>
                <div class="max-w-2xl mx-auto">
                    <div class="flex gap-2">
                        <input type="text" id="culture-question-input" class="flex-grow border border-slate-300 rounded-lg p-3 focus:ring-2 focus:ring-amber-500 focus:outline-none" placeholder="e.g., How do I say 'thank you'?">
                        <button id="ask-culture-btn" class="bg-amber-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-amber-600 transition">Ask</button>
                    </div>
                    <div id="culture-answer-container" class="mt-6 bg-stone-50 p-6 rounded-lg min-h-[100px] text-slate-700 whitespace-pre-wrap">
                        Your answer will appear here...
                    </div>
                </div>
            </div>
        </section>

    </main>

    <div id="ai-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-2xl font-bold text-amber-600">‚ú® AI Suggestions</h3>
                <button id="modal-close-btn" class="text-3xl text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div id="modal-body" class="whitespace-pre-wrap">
                <!-- AI content will be injected here -->
            </div>
        </div>
    </div>
    
    <script>
        const itineraryData = [
            {
                day: 1,
                date: "Sun, Oct 5",
                theme: "Immersion & Sensory Overload",
                icon: "‚ú®",
                plan: [
                    { time: "4PM-7PM", activity: "Arrival & Hotel Check-in", description: "Take the Airport Limousine Bus to Myeongdong, check into your hotel, and get refreshed for the evening." },
                    { time: "7PM onwards", activity: "Myeongdong Night Market Safari", description: "Wander the neon-lit streets and have dinner by sampling various street foods like Tornado Potato, Grilled Cheese Lobster, and Egg Bread." },
                    { time: "8:30PM", activity: "Wappen House", description: "Design your own personalized souvenirs by choosing unique patches to be ironed onto keychains or bags." }
                ]
            },
            {
                day: 2,
                date: "Mon, Oct 6",
                theme: "A Royal Journey",
                icon: "üèØ",
                plan: [
                    { time: "9AM-1PM", activity: "Gyeongbokgung Palace in Hanbok", description: "Rent traditional Hanbok attire (grants free palace entry!) and watch the Royal Guard Changing Ceremony at 10 AM." },
                    { time: "1PM", activity: "Lunch at Tosokchon Samgyetang", description: "Enjoy legendary ginseng chicken soup in a traditional hanok setting near the palace." },
                    { time: "2:30PM-5PM", activity: "Bukchon Hanok Village", description: "Explore the charming, preserved village of traditional Korean houses. Remember to be quiet as it's a residential area." },
                    { time: "5PM onwards", activity: "Explore Insadong & Ssamziegil", description: "Visit the unique Ssamziegil craft mall, have dinner at Gaeseong Mandu Koong (dumplings), and relax at a traditional teahouse." }
                ]
            },
            {
                day: 3,
                date: "Tue, Oct 7",
                theme: "History, Tension & Hope",
                icon: " binoculars ",
                plan: [
                    { time: "Full Day", activity: "DMZ Tour", description: "Take a pre-booked tour to the Demilitarized Zone. Visit Imjingak Park, the 3rd Infiltration Tunnel, and Dora Observatory. **MUST BRING PHYSICAL PASSPORTS**." },
                    { time: "Evening", activity: "Chimaek Dinner", description: "After a long day, relax with a classic Korean meal of fried chicken and beer (or soda for the younger one!) in Myeongdong at a spot like Chir Chir." }
                ]
            },
            {
                day: 4,
                date: "Wed, Oct 8",
                theme: "The Pulse of Modern Seoul",
                icon: "üèôÔ∏è",
                plan: [
                    { time: "10:30AM-1PM", activity: "COEX Complex & Bongeunsa Temple", description: "Visit the stunning Starfield Library and COEX Aquarium, then walk across to the serene, 1200-year-old Bongeunsa Temple." },
                    { time: "1PM", activity: "Lunch in Gangnam", description: "Choose between teen-friendly Shake Shack or upscale K-BBQ at Budnamujip." },
                    { time: "3PM", activity: "K-Star Road", description: "Fun photo-op with the 'GangnamDol' bear statues representing famous K-Pop groups in Apgujeong." },
                    { time: "5PM onwards", activity: "Namsan Tower at Sunset", description: "Take the Namsan Cable Car up before sunset to see the city view transform. Have a casual dinner at N Burger in the tower plaza." }
                ]
            },
            {
                day: 5,
                date: "Thu, Oct 9",
                theme: "Youth Culture & Creative Soul",
                icon: "üé®",
                plan: [
                    { time: "11AM onwards", activity: "Explore Hongdae", description: "Dive into the center of youth fashion, indie music, and street art. Great for trendy, affordable shopping." },
                    { time: "Lunch", activity: "Yoogane Chicken Galbi", description: "Enjoy a fun, interactive meal where spicy chicken and veggies are cooked at your table." },
                    { time: "Afternoon", activity: "Themed Cafe Hopping", description: "Visit quirky cafes like the Thanks Nature Cafe (with sheep!), the Harry Potter-themed 943 King's Cross, or the 2D cartoon Greem Cafe." },
                    { time: "5PM onwards", activity: "Watch Street Busking", description: "See talented K-pop dance crews and singers perform for free on the streets of Hongdae." }
                ]
            },
            {
                day: 6,
                date: "Fri, Oct 10",
                theme: "Market Discoveries & Riverside Views",
                icon: "üß∫",
                plan: [
                    { time: "10AM-1PM", activity: "Gwangjang Market Food Tour", description: "Visit one of Seoul's oldest markets. Try Bindaetteok (mung bean pancakes), Mayak Kimbap, and the famous Kalguksu (knife-cut noodles)." },
                    { time: "2PM-5PM", activity: "Namdaemun Market Exploration", description: "Get lost in the vast, labyrinthine market selling everything imaginable. A great place for people-watching." },
                    { time: "6PM onwards", activity: "Picnic at Banpo Hangang Park", description: "Enjoy a local pastime. Grab fried chicken and watch the spectacular Banpo Bridge Moonlight Rainbow Fountain show at 7:30 PM." }
                ]
            },
            {
                day: 7,
                date: "Sat, Oct 11",
                theme: "Lasting Impressions & Departure",
                icon: "‚úàÔ∏è",
                plan: [
                    { time: "Morning", activity: "Choose Your Adventure", description: "Option A (Calm): Visit the peaceful Namsangol Hanok Village. Option B (Fun): Explore the high-tech, interactive HiKR Ground K-Culture center." },
                    { time: "1PM", activity: "Final Lunch", description: "Have a last meal in Myeongdong. Try the famous and delicious Isaac Toast sandwiches." },
                    { time: "2PM", activity: "Head to Airport", description: "Be at an Airport Limousine Bus stop by 2 PM for your 6 PM flight. This allows ample time for travel, check-in, and tax refund processing." }
                ]
            }
        ];

        const hotelData = [
            { name: "Lotte Hotel Seoul", tier: "Luxury", rooms: "Family Twin Rooms", feature: "Ultimate luxury, connected to shopping" },
            { name: "Pacific Hotel", tier: "Upper Mid-Range", rooms: "Triple / Family Rooms", feature: "Excellent location, classic comfort" },
            { name: "Hotel Skypark Central", tier: "Mid-Range", rooms: "Triple / Family Rooms", feature: "Heart of the action, rooftop patio" },
            { name: "Orakai Insadong Suites", tier: "Aparthotel", rooms: "1-Bedroom Suites", feature: "Maximum space, kitchen, pool" }
        ];

        const foodData = [
            { name: "Kimchi Jjigae", description: "A rich, hearty, and spicy stew made with aged kimchi, tofu, and pork.", spice: 4 },
            { name: "Samgyetang", description: "A whole young chicken stuffed with glutinous rice, ginseng, and jujubes, served in a delicate broth.", spice: 1 },
            { name: "Bibimbap", description: "A bowl of warm rice topped with an array of seasoned vegetables, meat, and a fried egg, mixed with chili paste.", spice: 3 },
            { name: "Bulgogi", description: "Thinly sliced beef marinated in a sweet soy sauce and grilled. A non-spicy favorite.", spice: 1 },
            { name: "Japchae", description: "Savory and slightly sweet stir-fried glass noodles with vegetables and meat.", spice: 1 },
            { name: "Tteokbokki", description: "Chewy rice cakes and fish cakes simmered in a sweet and spicy red chili sauce.", spice: 4 },
            { name: "Bindaetteok", description: "A savory, crispy pancake made from ground mung beans, often with vegetables and meat.", spice: 1 },
            { name: "Kalguksu", description: "Hearty, handmade, knife-cut wheat noodles served in a rich broth, often with seafood or chicken.", spice: 1 },
            { name: "Samgyeopsal", description: "Thick slices of unmarinated pork belly grilled at the table. The quintessential K-BBQ experience.", spice: 1 },
            { name: "Naengmyeon", description: "A refreshing dish of chewy buckwheat noodles served in a chilled broth, perfect for warmer days.", spice: 1 },
            { name: "Hotteok", description: "A sweet, griddled pancake filled with a mixture of brown sugar, cinnamon, and nuts.", spice: 1 }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const itineraryContainer = document.getElementById('itinerary-container');
            const hotelContainer = document.getElementById('hotel-container');
            const foodContainer = document.getElementById('food-container');
            const foodFilters = document.getElementById('food-filters');
            const mainNav = document.getElementById('main-nav');
            const sections = document.querySelectorAll('.section');
            const tabs = document.querySelectorAll('.nav-tab');
            const modal = document.getElementById('ai-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const askCultureBtn = document.getElementById('ask-culture-btn');
            const cultureQuestionInput = document.getElementById('culture-question-input');
            const cultureAnswerContainer = document.getElementById('culture-answer-container');

            const apiKey = ""; 

            async function callGeminiAPI(prompt, maxRetries = 3) {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                            return result.candidates[0].content.parts[0].text;
                        } else {
                            throw new Error("Invalid response structure from API.");
                        }
                    } catch (error) {
                        if (i === maxRetries - 1) {
                            console.error("API call failed after multiple retries:", error);
                            return "Sorry, I couldn't get a response. Please check the API key and try again.";
                        }
                        const delay = Math.pow(2, i) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
            }

            function showModal(title, bodyContent) {
                modalTitle.textContent = title;
                modalBody.innerHTML = bodyContent;
                modal.classList.add('visible');
            }

            function closeModal() {
                modal.classList.remove('visible');
            }

            function showLoader() {
                return '<div class="flex justify-center items-center"><div class="loader"></div></div>';
            }

            async function handleKidFriendlyTweaks(e) {
                const day = e.target.dataset.day;
                const dayData = itineraryData.find(d => d.day == day);
                if (!dayData) return;

                showModal(`‚ú® Tweaks for Day ${day}`, showLoader());

                const planText = dayData.plan.map(p => `${p.activity}: ${p.description}`).join('\n');
                const prompt = `Here is a plan for a day in Seoul with the theme "${dayData.theme}":\n\n${planText}\n\nPlease suggest 2-3 specific, fun tweaks to make this day more exciting for a 12-year-old boy. Focus on interactive activities, cool shops, or fun snacks that could be added or swapped in. Keep the suggestions concise, practical, and in a simple list format.`;
                
                const response = await callGeminiAPI(prompt);
                modalBody.innerHTML = response;
            }

            async function handleCultureQuestion() {
                const question = cultureQuestionInput.value.trim();
                if (!question) {
                    cultureAnswerContainer.textContent = "Please enter a question first.";
                    return;
                }

                cultureAnswerContainer.innerHTML = showLoader();
                const prompt = `As a friendly guide for a tourist in South Korea, please answer this question clearly and concisely: "${question}"`;
                
                const response = await callGeminiAPI(prompt);
                cultureAnswerContainer.textContent = response;
            }

            function renderItinerary() {
                itineraryContainer.innerHTML = itineraryData.map(day => `
                    <div class="border border-stone-200 rounded-lg overflow-hidden">
                        <div class="day-card-header p-4 cursor-pointer flex justify-between items-center bg-stone-100 hover:bg-stone-200" data-day="${day.day}">
                            <div class="flex items-center">
                                <span class="text-2xl mr-4">${day.icon}</span>
                                <div>
                                    <h3 class="font-bold text-lg text-slate-800">Day ${day.day}: ${day.theme}</h3>
                                    <p class="text-sm text-slate-500">${day.date}</p>
                                </div>
                            </div>
                            <span class="text-2xl text-slate-400 transform transition-transform duration-500">&#x25BC;</span>
                        </div>
                        <div class="details-content">
                            <div class="p-4 border-t border-stone-200 bg-white">
                                <ul class="space-y-3">
                                    ${day.plan.map(item => `
                                        <li class="flex items-start">
                                            <strong class="w-24 text-right pr-4 font-semibold text-amber-600">${item.time}</strong>
                                            <div class="flex-1">
                                                <p class="font-semibold text-slate-700">${item.activity}</p>
                                                <p class="text-sm text-slate-600">${item.description}</p>
                                            </div>
                                        </li>
                                    `).join('')}
                                </ul>
                                <div class="mt-4 pt-4 border-t border-stone-200">
                                    <button class="kid-friendly-btn bg-amber-100 text-amber-800 font-semibold py-2 px-4 rounded-lg hover:bg-amber-200 transition text-sm" data-day="${day.day}">‚ú® Get Kid-Friendly Tweaks</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            function renderHotels() {
                hotelContainer.innerHTML = hotelData.map(hotel => `
                    <div class="bg-stone-100 p-4 rounded-lg h-full flex flex-col">
                        <h4 class="font-bold text-md text-slate-800">${hotel.name}</h4>
                        <p class="text-sm text-amber-700 font-semibold mb-1">${hotel.tier}</p>
                        <p class="text-sm text-slate-600 flex-grow">${hotel.feature}</p>
                        <p class="text-xs mt-2 bg-white text-slate-500 rounded-full px-2 py-1 self-start">${hotel.rooms}</p>
                    </div>
                `).join('');
            }
            
            function renderFood(filter = 'all') {
                const filteredData = foodData.filter(item => {
                    if (filter === 'all') return true;
                    if (filter === '2-3') return item.spice >= 2 && item.spice <= 3;
                    return item.spice == filter;
                });

                foodContainer.innerHTML = filteredData.map(food => `
                    <div class="bg-stone-100 p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                             <h4 class="font-bold text-lg text-slate-800">${food.name}</h4>
                             <span class="text-lg">${'üå∂Ô∏è'.repeat(food.spice)}</span>
                        </div>
                        <p class="text-slate-600 text-sm">${food.description}</p>
                    </div>
                `).join('');
            }

            function createTransportChart() {
                const ctx = document.getElementById('transport-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Airport Limousine Bus', 'AREX + Subway', 'Taxi'],
                        datasets: [
                            {
                                label: 'Estimated Cost (KRW for 3)',
                                data: [51000, 32700, 85000],
                                backgroundColor: 'rgba(245, 158, 11, 0.6)',
                                borderColor: 'rgba(245, 158, 11, 1)',
                                borderWidth: 1,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Estimated Time (minutes)',
                                data: [82, 68, 75],
                                backgroundColor: 'rgba(100, 116, 139, 0.6)',
                                borderColor: 'rgba(100, 116, 139, 1)',
                                borderWidth: 1,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        if (context.parsed.y !== null) {
                                            if(context.dataset.label.includes('Cost')){
                                                label += new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(context.parsed.y);
                                            } else {
                                                label += context.parsed.y + ' min';
                                            }
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Cost (KRW)' } },
                            y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Time (min)' }, grid: { drawOnChartArea: false } }
                        }
                    }
                });
            }
            
            itineraryContainer.addEventListener('click', e => {
                const header = e.target.closest('.day-card-header');
                if (header) {
                    const content = header.nextElementSibling;
                    const arrow = header.querySelector('span:last-child');
                    content.classList.toggle('open');
                    arrow.classList.toggle('rotate-180');
                }
                if (e.target.classList.contains('kid-friendly-btn')) {
                    handleKidFriendlyTweaks(e);
                }
            });

            foodFilters.addEventListener('click', e => {
                if (e.target.tagName === 'BUTTON') {
                    document.querySelectorAll('.food-filter-btn').forEach(btn => {
                        btn.classList.remove('bg-amber-500', 'text-white');
                        btn.classList.add('bg-stone-200', 'text-slate-700');
                    });
                    e.target.classList.add('bg-amber-500', 'text-white');
                    e.target.classList.remove('bg-stone-200', 'text-slate-700');
                    renderFood(e.target.dataset.filter);
                }
            });
            
            mainNav.addEventListener('click', e => {
                if (e.target.classList.contains('nav-tab')) {
                    const tabName = e.target.dataset.tab;
                    tabs.forEach(tab => tab.classList.remove('tab-active'));
                    e.target.classList.add('tab-active');
                    sections.forEach(section => section.classList.toggle('active', section.id === tabName));
                }
            });

            modalCloseBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', e => {
                if (e.target === modal) {
                    closeModal();
                }
            });
            askCultureBtn.addEventListener('click', handleCultureQuestion);
            cultureQuestionInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') {
                    handleCultureQuestion();
                }
            });

            function initialize() {
                renderItinerary();
                renderHotels();
                renderFood();
                createTransportChart();
                document.querySelector('.nav-tab[data-tab="overview"]').classList.add('tab-active');
                document.getElementById('overview').classList.add('active');
            }

            initialize();
        });
    </script>
</body>
</html>
